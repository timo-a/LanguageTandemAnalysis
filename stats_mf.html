 <!DOCTYPE html
 PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

  <head>
    <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="stylesheet.css"/>
  <title>Language Tandem Analysis - men vs women</title>
<!--script src="default_data.js"></script-->
<script src="data_mf.js"></script>
<style>
  .row  {margin: 30px; display: inline-block;}
  .cell {margin:  0px; display: inline-block;}
  .t {clear:both}
  .b {float:left}
  .title {width:inherit;  clear:both}
  .down { margin-top: 4mm }
  h1 {text-align:center}
  h2 {text-align:center; margin-top:50px}
  .alignright { text-align: right; }
  .entropytable {border-spacing: 10px;}
  .entropytable caption {  caption-side: bottom;}
  .entropytable th      {  text-align: left;}
</style>
 </head>
    <body>
         <a href="index.html">General stats</a>   <a href="stats_mf.html">male vs female</a>  <a href="stats_de.html">native vs international</a>  <a href="stats_jpsw.html">Japanese & Swedish</a>      
   <hr>   

   <h1>Are there differences between men and women?</h1>

   <div id="container" style="width: 80%;margin: auto;"> <!-- todo can body do this?-->
     <p id="pretext">
       Users placing ads are asked to input a salutation: either "Mrs. /Ms.", "Mr. ", or it can be left out. <br>
       #entries_men users chose "Mr. " henceforth referenced as men. <br>
       #entries_women users chose "Mrs. /Ms." henceforth referenced as women <br>
       #entries_other users didn't chose either. (at the time of writing/coding there were too few (16) to draw any meaningful conclusions, so I didn't investigate them any further)
     </p>
     <h2>Frequency of postings by day of the week</h2>
   <canvas id="entries_by_day_of_week" ></canvas>
   <p id="posttext">
     Do the frequencies of men and women stem from the same distribution?<br>
     Chi square test has a p-value of: #p_val</p>

     <h2>Number of Languages</h2>

Let's look at the number of languages people offer. For clarity in the following '#o' means 'number of languages offered' and '#s' 'searched for' respectively. <br>
  <div class="row"> <!-- overall most popular -->
    <div id="down1" class="down">
      <div>men</div>
      <div class="cell">
	<table id='sd_table_m'></table>
      </div>
    </div>
  </div>

  <div class="row"> <!-- overall most popular -->
    <div id="down1" class="down">
      <div>women</div>
      <div class="cell">
        <table  id='sd_table_f'></table> 
      </div>
    </div>
  </div>

  
  <div class="row"> <!-- overall most popular -->
    <div id="down1" class="down">
      <div class="cell">
	<table id="sd_table" class=entropytable>
	 <!-- caption>Entropy regarding gender of a poster</caption-->
         <tr> <th></th>         <th>men</th>  <th>women</th> </tr>
         <tr> <td>#s > #o</td>  <td style="text-align:right">#m_search%</td>     <td style="text-align:right">#f_search%</td>     </tr>
         <tr> <td>#s = #o</td>  <td style="text-align:right">#m_same% </td>      <td style="text-align:right">#f_same% </td>      </tr>
         <tr> <td>#s < #o</td>  <td style="text-align:right">#m_offer%</td>      <td style="text-align:right">#f_offer%</td>      </tr>
         <tr> <td>mean #s</td>  <td style="text-align:right">#m_mean_search</td> <td style="text-align:right">#f_mean_search</td> </tr>
         <tr> <td>mean #o</td>  <td style="text-align:right">#m_mean_offer </td> <td style="text-align:right">#f_mean_offer </td> </tr>
        </table> 

	</div>
    </div>
  </div>
  


  <h2>Distribution of Languages</h2>
  <div class="row"> <!-- demand -->
    <div id ="t1" class="title">people searching for a language</div>
    <div id="down1" class="down">
      <div class="cell">
        men<br>
        <table  id='t_d_m' class="t"></table> 
      </div>
      <div class="cell" style="margin-left:20px">
        women<br>
        <table  id='t_d_f' class="t"></table> 
      </div>
    </div>
  </div>



  <div class="row"> <!-- supply -->
    <div id ="t2" class="title">people offering a language</div>
    <div id="down1" class="down">
      <div class="cell">
        men<br>
        <table  id='t_s_m' class="t"></table> 
      </div>
      <div class="cell" style="margin-left:20px">
        women<br>
        <table  id='t_s_f' class="t"></table> 
      </div>
    </div>
  </div>

      <br>  <hr>  <br>
        <p id="language_choices">
	Do men and women differ in their choice of languages to learn/offer?<br>
	We look at languages that have more than 5 occurrences in at least one gender.<br>
	For languages <em>offered</em>, a chi-square test for homogeneity yields a p value of #p_offer.<br>
	For languages <em>searched</em> for, a chi-square test for homogeneity yields a p value of #p_search.
	</p>


	<h2>Entropy</h2>
	<p id="entropy">
	Let's say we want to guess whether a random entry was made by a man or a woman.<br>
	We are allowed to ask "Does the entry search for language X". Then it is best to ask about #demand_lang.<br>
	It will decrease entropy from #demand_from to #demand_to.<br>
        If we are instead allowed to ask for one language <em>offered</em>, it is best to ask about #offer_lang.<br>
	It will decrease entropy from #offer_from to #offer_to.<br>
        What is the total information we can gain from language information?
        For this we train an optimal bayes classifier and compute the entropy on the partition from the classifier.<br>
        Knowing the languages an entry is searching for reduced the entropy to #infogain_search.<br>
        Knowing the languages an entry is offering reduced the entropy to #infogain_offer.<br>
        Knowing both the languages an entry is searching for and offering reduced the entropy to #infogain_both.<br>
	And summarized in a table:
	<table id="entropytable" class=entropytable  >
	 <caption>Entropy regarding gender of a poster</caption>
         <tr> <th>Entropy</th>         <th>when we know</th> </tr>
         <tr> <td>#prior</td>          <td>nothing</td>      </tr>
         <tr> <td>#e_1lang_search</td> <td>whether or not entry searches for #l_1lang_search</td> </tr>
         <tr> <td>#e_1lang_offer</td>  <td>whether or not entry offers #l_1lang_offer</td>        </tr>
         <tr> <td>#search</td>         <td>what languages an entry searches for</td>              </tr>
         <tr> <td>#offer</td>          <td>what languages an entry offers</td>                    </tr>
         <tr> <td>#both</td>           <td>what languages an entry searches for and offers </td>  </tr>
        </table> 
	
	</p>
	<hr>
	  For general statistics see <a href="index.html">here</a>.<br>
	  <!-- For statistics about the relation between male and female users see <a href="stats_mf.html">here</a>.<br -->
	  For statistics about the relation between native german speakers and german learners see <a href="stats_de.html">here</a><br>
	  For statistics about Japanese and Swedish see <a href="stats_jpsw.html">here</a>.<br>
	  For charts that aren't quite presentable yet see <a href="experimental.html">here</a>..

</div> <!-- closes margin -->	
<link type="text/css" rel="stylesheet" href="stylesheet_force.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
	    
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


<script >
//schema table_overall_d_m
  
  var t_id = []
  var l_id = []
  for (n of ['overall', 'first', 'additional','last']){
      t_id.push('t_'+n+'_d')
      t_id.push('t_'+n+'_s')
  }

  var s_tables = t_id.map( x => document.getElementById(x));
		    

function setDivWidth(){    //regulates width of text, barely neccessary here but just in case 
    list_ids = ["t1","t2"]
    boxes = list_ids
    for (id of boxes){
        e= document.getElementById(id)
        e.setAttribute("style","width:0px;");
        w=e.parentElement.children[1].offsetWidth
        sum=w+"px"
        e.setAttribute("style","width:"+sum+"; clear:both");
        //e.style.width=sum;
        //https://stackoverflow.com/questions/10118172/setting-div-width-and-height-in-javascript
    }
    return 3;
}
    
  var insert_rough_data = function() {
    var p = document.getElementById("pretext");
    p.innerHTML = p.innerHTML.replace("#entries_men",   entries_men)
                             .replace("#entries_women", entries_women)
                             .replace("#entries_other", entries_other)  ;
    var po = document.getElementById("posttext");
    if(weekday_chi < 0.05){ var text = " → we assume they don't." }
		     else { var text = " → we assume they do."}
    po.innerHTML = po.innerHTML.replace("#p_val",  weekday_chi+text);

    var p = document.getElementById("entropy");

    p.innerHTML = p.innerHTML.replace("#offer_lang", _lang_plural(infogain_offer_1lang.languages))
                             .replace("#offer_from", infogain_offer_1lang.from)
                             .replace("#offer_to",   infogain_offer_1lang.to);

    p.innerHTML = p.innerHTML.replace("#demand_lang", _lang_plural(infogain_search_1lang.languages))
                             .replace("#demand_from", infogain_search_1lang.from)
                             .replace("#demand_to",   infogain_search_1lang.to);

    p.innerHTML = p.innerHTML.replace("#infogain_search", infogain_search)
                             .replace("#infogain_offer",  infogain_offer )
                             .replace("#infogain_both",   infogain_both  );

    var p = document.getElementById("entropytable");
    p.innerHTML = p.innerHTML.replace("#prior", infogain_offer_1lang.from)
                             .replace("#e_1lang_offer",  infogain_offer_1lang.to )
                             .replace("#l_1lang_offer",  _lang_plural(infogain_offer_1lang.languages)  )
                             .replace("#e_1lang_search",  infogain_search_1lang.to )
                             .replace("#l_1lang_search",  _lang_plural(infogain_search_1lang.languages)  )
			     .replace("#search", infogain_search)
			     .replace("#offer",  infogain_offer )
			     .replace("#both",   infogain_both  );



var p = document.getElementById("language_choices");
    p.innerHTML = p.innerHTML.replace("#p_offer",  _lang_pvalue(pval_mf_offer) )
                             .replace("#p_search", _lang_pvalue(pval_mf_search));
    
  }
  var _lang_plural = function(arr) {
    l = arr.length
    if (l == 0) {
       console.log("infogain_??.languages are empty?!")
    } else if (l == 1) {
       return arr[0]
    } else {
       return "either " + arr.slice(0, l-1).join(', ') + " or " + arr[l-1]
    }
  
  }
  var _lang_pvalue = function(p) {
    if (p < 0.05) {
       return p + " leading us to believe that men/women have different distributions"
    } else {
       return p + " leading us to believe that language choices are distributed equally"
    }
  }
  
    var p = document.getElementById("sd_table");    
    p.innerHTML = p.innerHTML.replace("#m_search",      sup_vs_dem_m['want_more'] )
                             .replace("#m_same",        sup_vs_dem_m['same']      )
                             .replace("#m_offer",       sup_vs_dem_m['offer_more'])
                             .replace("#m_mean_search", sup_vs_dem_m_mean['expected_demand'])
                             .replace("#m_mean_offer",  sup_vs_dem_m_mean['expected_supply'])
		             .replace("#f_search",      sup_vs_dem_f['want_more'] )
                             .replace("#f_same",        sup_vs_dem_f['same']      )
                             .replace("#f_offer",       sup_vs_dem_f['offer_more'])
                             .replace("#f_mean_search", sup_vs_dem_f_mean['expected_demand'])
                             .replace("#f_mean_offer",  sup_vs_dem_f_mean['expected_supply']);
		    

  var onload_rank =   function() {
    //var t = document.getElementById("table_amortized_demand"); t.innerHTML = table_remaining_dem;
    //var t = document.getElementById("table_amortized_supply"); t.innerHTML = table_remaining_sup;
  
    var t = document.getElementById("t_d_m"); t.innerHTML = table_overall_d_m;
    var t = document.getElementById("t_s_m"); t.innerHTML = table_overall_s_m;
  
    var t = document.getElementById("t_d_f");   t.innerHTML = table_overall_d_f;
    var t = document.getElementById("t_s_f");   t.innerHTML = table_overall_s_f;
            
  }
    
  window.onload = function() {
    insert_rough_data();
    onload_rank();
    
    var t = document.getElementById("sd_table_m");
    t.innerHTML = sup_vs_dem_m_tablecontent
    var t = document.getElementById("sd_table_f");
    t.innerHTML = sup_vs_dem_f_tablecontent
/*    var p = document.getElementById("lang_text");
    p.innerHTML = p.innerHTML.replace("#want_more", lang_want_more)
                             .replace("#same",      lang_same)
                             .replace("#offer_more",lang_offer_more)
                             .replace("#lang_expected_demand", lang_expected_demand)
                             .replace("#lang_expected_supply", lang_expected_supply);
*/      
      setDivWidth();
  }
  


  //var week_day_all =  [12, 19, 3, 5, 2, 3,3]
</script>
<script src="bar_charts_mf.js"></script>

  
 </body>
</html>
