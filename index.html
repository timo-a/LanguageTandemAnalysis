 <!DOCTYPE html
 PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

  <head>
    <meta charset="utf-8">
  <link type="text/css" rel="stylesheet" href="stylesheet.css"/>
  <title>Language Tandem Analysis</title>
<!--script src="default_data.js"></script-->
<script src="data.js"></script>
<style>
  .row  {margin: 30px; display: inline-block;}
  .cell {margin:  0px; display: inline-block;}
  .t {clear:both}
  .b {float:left}
  .title {width:inherit;  clear:both}
  .down { margin-top: 4mm }
  h2 {text-align:center; margin-top:50px}
    .alignright { text-align: right; }
</style>
 </head>

 <body>
   <div id="container" style="width: 80%;margin: auto;">
   <p id="pretext">
   We analyse posts on an online board for finding tandem partners for language learning at my university. The goal of such boards is to connect language learners, so e.g. a person speaking A and learning B can find a person speaking B and learning A.<br>
   Only one party needs to make an entry, anyone with an email address can respond to an entry on the board. This means that the conclusions we draw refer to the learners to take the initiative and post their contact information publicly. We don't know anything about the people responding to   the entries on the board.<br>
   We analyse #no_valid_entries entries, from #from to #to.<br>
   There are on average #hits_per_day new entries a day. That means there are #time_between_hits between entries on average.<br>
   In our collected data we have encountered #unique_total unique languages people are searching for and offering.<br>
   We found #unique_search languages people are searching for and #unique_offer languages people are offering to teach.
   </p>
   <h2>Frequency of postings by day of the week</h2>
   <canvas id="entries_by_day_of_week" ></canvas>
   <p id="posttext">
    Is the deviation from the uniform distribution significant? Chi square test has a p-value of: #p_val</p>

    <h2>Frequency of postings by day of the year</h2>
    <canvas id="entries_by_doy" ></canvas>
  
  <br>  <hr>  <br>
  Let's look at the number of languages people offer
  <table  id='lang_table'></table>
  <p id="lang_text" align='left'>#want_more people are looking for more languages than they are offering, <br>
      #offer_more people are offering to teach more languages then they are looking to learn and <br>
	#same people are looking for as many languages as they are offering. <br>
	The average person is looking to learn #lang_expected_demand and offering #lang_expected_supply languages.
  </p>
  Let's look at the distribution of languages
    
  <div id="search_blocks_div" style="width: 100%;">
    <canvas id="searching"></canvas>  <br>
    <table id="search_table"></table>
  </div>
  <div id="offer_blocks_div"  style="width: 100%;">
    <canvas id="offering"></canvas> <br>
    <table id="offer_table"></table>
  </div>

  <br>  <hr>  <br> 
  <div class="row"> <!-- overall most popular -->
    <div id ="t1" class="title">Overall popularity,<br> number of people searching for/ offering a language</div>
    <div id="down1" class="down">
      <div class="cell">
        demand<br>
        <button id="t_overall_d_button" class="b"  >show all</button><br>
        <table  id='t_overall_d' class="t"></table> 
      </div>
      <div class="cell">
        supply<br>
        <button id="t_overall_s_button" class="b"  >show all</button><br>
        <table  id='t_overall_s' class="t"></table> 
      </div>
    </div>
  </div>

  <div class="row"> <!-- 1st choice most popular -->
    <div id ="t2" class="title">First Choice<br>Among people listing several languages, #people listing the language first</div>
    <div id="down1" class="down">
      <div class="cell">
        demand<br>
        <button id="t_first_d_button" class="b"  >show all</button><br>
        <table  id='t_first_d' class="t"></table> 
      </div>
      <div class="cell">
        supply<br>
        <button id="t_first_s_button" class="b"  >show all</button><br>
        <table  id='t_first_s' class="t"></table> 
      </div>
    </div>
  </div>

  <div class="row"> <!-- additional choice most popular -->
    <div id ="t3" class="title">Next Choice<br>Among people listing several languages, #people listing the language not first</div>
    <div id="down1" class="down">
      <div class="cell">
        demand<br>
        <button id="t_additional_d_button" class="b"  >show all</button><br>
        <table  id='t_additional_d' class="t" ></table> 
      </div>
      <div class="cell">
        supply<br>
        <button id="t_additional_s_button" style="float:left"  >show all</button><br>
        <table  id='t_additional_s' class="t" ></table> 
     </div>
   </div>
  </div>

    <div class="row"> <!-- additional choice most popular -->
      <div id ="t4" class="title">Last Choice<br>Among people listing several languages, #people listing the language last</div>
    <div id="down1" class="down">
    <div class="cell">
      demand<br>
      <button id="t_last_d_button" class="b"  >show all</button><br>
      <table  id='t_last_d' class="t" ></table> 
    </div>
    <div class="cell">
      supply<br>
      <button id="t_last_s_button" style="float:left"  >show all</button><br>
      <table  id='t_last_s' class="t" ></table> 
   </div>
   </div>
  </div>

  <br>  <hr>  <br>
  <div class="row">
    <div class="cell">
      amortized demand<br>
      <button id="tad_button" class="b"  >show all</button><br>
      <table  id='table_amortized_demand' class="t"  ></table> 
    </div>
    <div class="cell">
      amortized supply<br>
      <button id="tas_button" class="b"  >show all</button><br>
      <table  id='table_amortized_supply' class="t"   ></table> 
    </div>
    <div id="b" style="float:bottom; clear:both; margin: 10px;  ">
    <p id="remain_text">There's exactly as much demand as supply for #str_remaining_same.</p>
    </div>
  </div>
      <br>
	<hr>
	  For statistics about the relation between male and female users see <a href="stats_mf.html">here</a><br>
	  For charts that aren't quite presentable yet see <a href="experimental.html">here</a>


</div> <!-- ends the margin div  -->
	    
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


<script >
  var b_id = ['tad_button',            'tas_button',           ]
  var t_id = ['table_amortized_demand','table_amortized_supply']
//  var l_id = ['table_amortized_demand','table_amortized_supply']
  for (n of ['overall', 'first', 'additional','last']){
      b_id.push('t_'+n+'_d_button')
      b_id.push('t_'+n+'_s_button')
      t_id.push('t_'+n+'_d')
      t_id.push('t_'+n+'_s')
  }

  var bs       = b_id.map( x => document.getElementById(x));
  var s_tables = t_id.map( x => document.getElementById(x));



  
  
    
  		    

function setDivWidth(){
    list_ids = ["t1","t2","t3","t4"]
    boxes = list_ids
    for (id of boxes){
        e= document.getElementById(id)
        e.setAttribute("style","width:0px;");
        w=e.parentElement.children[1].offsetWidth
        sum=w+"px"
        e.setAttribute("style","width:"+sum+"; clear:both");
        //e.style.width=sum;
        //https://stackoverflow.com/questions/10118172/setting-div-width-and-height-in-javascript
    }
    return 3;
}
    
  var insert_rough_data = function() {
    var p = document.getElementById("pretext");
    p.innerHTML = p.innerHTML.replace("#unique_total",  unique_langs_both  )
                             .replace("#unique_search", unique_langs_search)
                             .replace("#unique_offer",  unique_langs_offer )
                             .replace("#no_valid_entries",  no_valid_entries)
                             .replace("#from",from)
                             .replace("#to",to) 
                             .replace("#hits_per_day",      hits_per_day)
                             .replace("#time_between_hits", time_between_hits)  ;
    var po = document.getElementById("posttext");
    po.innerHTML = po.innerHTML.replace("#p_val",  p_val);
  }
		    
  var insert_low_count_langs = function(){
    var t = document.getElementById("search_table");
    t.innerHTML = search_low_count_table;

    var t = document.getElementById("offer_table");
    t.innerHTML = offer_low_count_table;
  }    
		    

  var onload_rank =   function() {
    var t = document.getElementById("table_amortized_demand"); t.innerHTML = table_remaining_dem;
    var t = document.getElementById("table_amortized_supply"); t.innerHTML = table_remaining_sup;
  
    var t = document.getElementById("t_overall_d"); t.innerHTML = table_overall_dem;
    var t = document.getElementById("t_overall_s"); t.innerHTML = table_overall_sup;
  
    var t = document.getElementById("t_first_d");   t.innerHTML = table_first_dem;
    var t = document.getElementById("t_first_s");   t.innerHTML = table_first_sup;
    
    var t = document.getElementById("t_additional_d"); t.innerHTML = table_additional_dem;
    var t = document.getElementById("t_additional_s"); t.innerHTML = table_additional_sup;
  
    var t = document.getElementById("t_last_d");    t.innerHTML = table_last_dem;
    var t = document.getElementById("t_last_s");    t.innerHTML = table_last_sup;
    
    var p = document.getElementById("remain_text");
    p.innerHTML =  p.innerHTML.replace("#str_remaining_same", str_remaining_same)
      
  }
    
  window.onload = function() {
    insert_rough_data();
    insert_low_count_langs();
    onload_rank();
    
    var t = document.getElementById("lang_table");
    t.innerHTML = lang_tablecontent
    var p = document.getElementById("lang_text");
    p.innerHTML = p.innerHTML.replace("#want_more", lang_want_more)
                             .replace("#same",      lang_same)
                             .replace("#offer_more",lang_offer_more)
                             .replace("#lang_expected_demand", lang_expected_demand)
                             .replace("#lang_expected_supply", lang_expected_supply);
  
    
    for (i=0; i<bs.length; i++){  bs[i].table = s_tables[i] };
  
      bs.forEach(shrink)
      setDivWidth();
  }
  


  //var week_day_all =  [12, 19, 3, 5, 2, 3,3]
</script>
<script src="bar_charts.js"></script>

<script>
for (rb of bs){  
  rb.shrink_text = "show only top 5"
  rb.expand_text = "show all"
}

function shrink(button){

  var t = button.table;
  for (i = 5; i < t.rows.length; i++) {
    t.rows[i].style.display='none'
  }
  button.innerText = button.expand_text 
} 

function expand(button){
    var t =  button.table
    for (i = 5; i < t.rows.length; i++) {//expand_action
        t.rows[i].style.display= t.rows[0].style.display  //'initial'
    }
    button.innerText = button.shrink_text
} 

for (b of bs){
  b.addEventListener('click', function() {
    switch(this.innerText){
        case this.expand_text: expand(this); console.log("e"); break;
	case this.shrink_text: shrink(this); console.log("s"); break;
    }
  });
}
  
</script>

  <!--script defer>
        // JavaScript here...
  </script-->

  
 </body>
</html>
